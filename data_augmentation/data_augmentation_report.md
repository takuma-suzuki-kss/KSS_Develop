
## インスタンスセグメンテーションにおけるマスク境界精度向上による3Dピッキング精度改善の検討

---

### ① 背景

京都製作所では、3DセンサとAIを組み合わせたピッキングシステムを開発した。インスタンスセグメンテーションを用いた3DPickは、AIとルールベース処理を併用することで100％のピッキング精度を実現している。しかし、AI単体では物体のマスク領域の境界精度が不十分であり、ルールベースによる補完が不可欠となっている。

この課題は、インスタンスセグメンテーションにおけるマスクの境界が曖昧であることに起因しており、ピッキング位置の誤差や未検出の発生につながっている。

---

### ② 目的

本研究の目的は、3DピッキングにおけるAI単体での高精度化を実現するために、インスタンスセグメンテーションのマスク境界精度を向上させることである。具体的には、既存および新規のデータ拡張手法と損失関数設計を導入し、その効果を定量的に評価することで、ルールベースに依存しないピッキングシステムの実現に向けた改善方針を明確化する。

---

### ③ 材料と方法

#### 3.1 データセット
- 既存データ：社内で収集された3Dピッキング対象物のRGB-D画像（約20枚）
- 拡張データ：背景変更、部分隠蔽、ノイズ付加などを施した合成画像（1,050枚）。  
  アノテーションは既存データから自動生成。

#### 3.2 モデル構成
- ベースモデル：Mask R-CNN（ResNet50バックボーン）
- 損失関数の重み比率（バウンディングボックスの重み、クラスの重み、マスクの重み）

<div style="page-break-before:always"></div>
---

#### 3.3 データ拡張手法

以下の手法を用いて拡張データを作り学習させ、ベースラインの学習済みモデルとする。

| No | 手法 | 目的 |
|----|------|------|
| 1 | 貼り付け | ワークの多様性向上 |
| 2 | 回転 | 姿勢バリエーションの増加 |
| 3 | バイラテラルフィルタ | ワークの平滑化とノイズ除去 |
| 4 | シャープネス強調 | ワークのエッジ強調 |
| 5 | 明暗補正 | ワークの多様性向上 |
| 6 | コントラスト補正 | ワークの多様性向上 |
| 7 | 貼り付け画像の分離管理 | よりリアルな合成 |
| 8 | アノテーション見直し（全体写り） | 不完全なマスクの排除 |
| 9 | アノテーション見直し（穴なし） | マスクの精度向上 |
| 10 | オフライン拡張 | データ量の増加 |

- 検討手法：

| 手法 | 目的 | 境界精度への期待効果 |
|------|------|------------------------|
| マスク損失の重み増加 | マスク予測への学習リソース集中 | 境界の精度向上 |
| lapクラスの統合 | クラス不均衡の解消、学習安定化 | 境界の明瞭化、誤分類の減少 |
| Gaussian Blur + ノイズ付加 | 境界の曖昧さへの耐性向上 | ロバスト性の向上、過学習の抑制 |

- 手順
  - データ拡張で生成した学習用画像1000枚を用いて、検討手法の条件を変えて学習モデルを作成
  - 学習モデルを用いて、データ拡張で生成した評価用画像50枚を用いて、次の評価指標をもって定量評価を行う。
  - 各種、検討手法の効果を数値または目視にて確認し、考察をする。


#### 3.4 評価指標

- クラスごとの精度・再現率
- 混合行列におけるローカライズの偽陽性数（位置に関する指標）
  - 上記偽陽性のIoU（Intersection over Union）の最大最小値を確認（手作業による集計になるため簡略化する）

---
<div style="page-break-before:always"></div>
---

#### 3.5 評価ワーク

ワークサイズ　（小、中、大）

|![alt text](assets/image-1.png)Q573 味の素AGF（コーヒースティック）|![alt text](assets/image.png) Q441 銀座コージーコーナー（フィナンシェ）|
|-----|-----|
|![alt text](assets/image-2.png)Q585 旭化成メディカル（ダイアライザー）||
　

### ④ 結果

- 損失関数のマスクの重みを0.65→1.0に変更により、LoCの減少を確認
  - ワーク全体が写るクラスのLoCは最大66％減少した。
  - クラスごとの精度は最大100%、再現率は54%に達した

- lapクラス統合により、誤分類率が約***%低下。
  - ワーク全体が写るクラスのLoCは最大***％減少した。
  - クラスごとの精度は最大***%、再現率は***%に達した

- Gaussian Blur + ノイズ付加により、再現率が約***%向上。

---
<div style="page-break-before:always"></div>

- 出力モデルに関して、mean_APが最も高い時点のモデルをbest_model、最終Epoch後に出力されるモデルをfinal_modelとしているが、LoCに注目すると、final_modelの方が少ない傾向にある。マスク精度を重要指標とすると、モデルはfinal_modelを採用して評価をする。


|best|final|
|-----|-----|
|精度に関して||
![W:384](Q441_default_best_image.png)|![W:384](Q441_default_final_image-1.png)|
|LoCに関して||
![W:384](Q441_default_best_image-2.png)|![W:384](Q441_default_final_image-3.png)|



<div style="page-break-before:always"></div>

---
![W:256](assets/image-1.png)
|Q573 味の素AGF（コーヒースティック）|||
|-----|-----|-----|
|default|マスク重み0.65→1.0|マスク重み0.65→0.1|
|![W:256](Q573_default_final_image.png)|![W:256](Q573_maskpara_image-10.png)||
|![H:384](Q573_default_final_image-1.png)|![H:384](Q573_maskpara_image-11.png)||
---
<div style="page-break-before:always"></div>


![W:256](assets/image.png)
|Q441_銀座コージコーナー（フィナンシェ）|||
|-----|-----|-----|
|dafult|マスク重み0.65→1.0|マスク重み0.65→0.1|
|![W:256](Q441_default_final_image-1.png)|![W:256](Q441_maskpara_image-1.png)|
|![W:256](Q441_default_final_image-3.png)|![W:256](Q441_maskpara_image-3.png)|
---

<div style="page-break-before:always"></div>

---
![W:256](assets/image-2.png)
| Q585 旭化成メディカル（ダイアライザー）|||
|-----|-----|-----|
|dafult|マスク重み0.65→1.0|マスク重み0.65→0.1|
|![W:256](Q585_default_final_image.png)|![w:256](Q585_maskpara_final_image-1.png)|
|![w:256](Q585_default_best_image-1.png)|![w:256](Q585_maskpara_image-2.png)|


---
<div style="page-break-before:always"></div>
---

### ⑤ 考察

本研究では、マスク境界精度の向上がピッキング精度に直結することを定量的に示した。

---

### ⑥ 結論

本研究では、3DピッキングにおけるAI単体での高精度化を目指し、インスタンスセグメンテーションのマスク境界精度向上に焦点を当てた。

予定）データ拡張と損失関数設計の両面からのアプローチにより、マスク精度の大幅な改善が確認された。

今後は、ピッキング対象のサイズを考慮した最適なパラメータの自動設定を目指し、完全自律型ピッキングシステムの実現を目指す。

